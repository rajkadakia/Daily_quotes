name: ğŸ” Rotate Quotes in README

on:
  schedule:
    - cron: '0 0 */4 * *'
  workflow_dispatch:

jobs:
  rotate-quote:
    runs-on: ubuntu-latest

    steps:
      - name: â¬ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ§° Set up Git
        run: |
          git config --global user.name "rajkadakia"
          git config --global user.email "rk2163@srmist.edu.in"

      - name: ğŸ“– Read current quote type
        id: quote_type
        run: |
          TYPE=$(cat quote_type.txt)
          echo "QUOTE_TYPE=$TYPE" >> $GITHUB_ENV

      - name: ğŸ§  Fetch quote
        id: get_quote
        run: |
          if [[ "${QUOTE_TYPE}" == "motivational" ]]; then
            JSON=$(curl -s https://zenquotes.io/api/random)
            QUOTE=$(echo "$JSON" | jq -r '.[0].q')
            AUTHOR=$(echo "$JSON" | jq -r '.[0].a')
            NEXT_TYPE="tech"
          else
            JSON=$(curl -s https://programming-quotes-api.vercel.app/api/random)
            QUOTE=$(echo "$JSON" | jq -r '.en')
            AUTHOR=$(echo "$JSON" | jq -r '.author')
            NEXT_TYPE="motivational"
          fi

          echo "QUOTE_TEXT=$QUOTE" >> $GITHUB_ENV
          echo "QUOTE_AUTHOR=$AUTHOR" >> $GITHUB_ENV
          echo "NEXT_QUOTE_TYPE=$NEXT_TYPE" >> $GITHUB_ENV
          echo "UPDATED_TIME=$(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> $GITHUB_ENV

      - name: ğŸ“ Update README
        run: |
          sed -i '/<!-- START_QUOTES -->/,/<!-- END_QUOTES -->/c\<!-- START_QUOTES -->\n> '"$QUOTE_TEXT"' â€” *'"$QUOTE_AUTHOR"'*\n\nâ±ï¸ Last updated: '"$UPDATED_TIME"'\n<!-- END_QUOTES -->' README.md

      - name: ğŸ’¾ Update quote type
        run: echo "$NEXT_QUOTE_TYPE" > quote_type.txt

      - name: ğŸš€ Commit and Push
        run: |
          git add README.md quote_type.txt
          git commit -m "ğŸ” Rotate quote to $NEXT_QUOTE_TYPE [skip ci]" || echo "No changes"
          git push origin main
