name: Rotate 3 Quotes Every 4 Days

on:
  schedule:
    - cron: '0 0 */4 * *'  # Every 4 days at midnight UTC
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Git
        run: |
          git config --global user.name "rajkadakia"
          git config --global user.email "rk2163@srmist.edu.in"

      - name: Read quote type
        id: quote_type
        run: |
          TYPE=$(cat quote_type.txt)
          echo "type=$TYPE" >> $GITHUB_OUTPUT

      - name: Fetch and commit 3 quotes
        run: |
          for i in {1..3}
          do
            if [ "${{ steps.quote_type.outputs.type }}" = "motivational" ]; then
              QUOTE=$(curl -s https://zenquotes.io/api/random | jq -r '.[0].q + " ‚Äî " + .[0].a')
            else
              QUOTE=$(curl -s https://api.quotable.io/random?tags=technology,famous-quotes | jq -r '.content + " ‚Äî " + .author')
            fi

            # Insert new quote before <!--QUOTE_END-->
            awk -v quote="> _${QUOTE}_" '
              /<!--QUOTE_END-->/ {
                print quote "\n";
              }
              { print }
            ' README.md > temp.md && mv temp.md README.md

            git add README.md
            git commit -m "üîÅ Added quote $i: $QUOTE"
            sleep $((RANDOM % 10 + 5))
          done

          git push

      - name: Rotate quote type
        run: |
          CURRENT=$(cat quote_type.txt)
          if [ "$CURRENT" = "motivational" ]; then
            echo "tech" > quote_type.txt
          else
            echo "motivational" > quote_type.txt
          fi
          git add quote_type.txt
          git commit -m "‚ôªÔ∏è Rotated quote type"
          git push
