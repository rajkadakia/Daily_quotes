name: Rotate Quotes in README

on:
  schedule:
    - cron: '0 0 */4 * *' # Every 4 days at midnight UTC
  workflow_dispatch:

jobs:
  rotate-quote:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Git
        run: |
          git config --global user.name "rajkadakia"
          git config --global user.email "rk2163@srmist.edu.in"

      - name: Pick quote type
        id: quote_type
        run: |
          if [ $((RANDOM % 2)) -eq 0 ]; then
            echo "type=motivational" >> $GITHUB_OUTPUT
          else
            echo "type=tech" >> $GITHUB_OUTPUT
          fi

      - name: Fetch and commit 3 quotes
        run: |
          QUOTE_TYPE="${{ steps.quote_type.outputs.type }}"
          for i in {1..3}
          do
            if [ "$QUOTE_TYPE" = "motivational" ]; then
              QUOTE=$(curl -s https://zenquotes.io/api/random | jq -r '.[0].q + " ‚Äî " + .[0].a')
            else
              QUOTE=$(curl -s https://api.quotable.io/random?tags=technology,famous-quotes | jq -r '.content + " ‚Äî " + .author')
            fi

            awk -v quote="> _${QUOTE}_" '
              /<!--QUOTE_END-->/ {
                print quote "\n";
              }
              { print }
            ' README.md > temp.md && mv temp.md README.md

            git add README.md
            if git diff --cached --quiet; then
              echo "‚ö†Ô∏è Quote $i not added (duplicate or unchanged)"
            else
              git commit -m "üîÅ Added quote $i"
              sleep $((RANDOM % 10 + 5))
            fi
          done

          git push
