name: Rotate Quote from API

on:
  schedule:
    - cron: '0 0 */4 * *'  # Every 4 days
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Read current quote type
        id: quote_type
        run: |
          TYPE=$(cat quote_type.txt)
          echo "type=$TYPE" >> $GITHUB_OUTPUT

      - name: Fetch quote from API
        id: fetch_quote
        run: |
          if [ "${{ steps.quote_type.outputs.type }}" = "motivational" ]; then
            QUOTE=$(curl -s https://zenquotes.io/api/random | jq -r '.[0].q + " â€” " + .[0].a')
          else
            QUOTE=$(curl -s https://api.quotable.io/random?tags=technology,famous-quotes | jq -r '.content + " â€” " + .author')
          fi
          echo "quote=$QUOTE" >> $GITHUB_OUTPUT

      - name: Update README
        run: |
          echo -e "\nğŸ“œ **Quote of the Day**:\n\n> _${{ steps.fetch_quote.outputs.quote }}_" >> README.md
          git config --global user.name "rajkadakia"
          git config --global user.email "rk2163@srmist.edu.in"
          git add README.md
          git commit -m "ğŸ“– Updated quote from API"
          git push

      - name: Rotate quote type
        run: |
          CURRENT=$(cat quote_type.txt)
          if [ "$CURRENT" = "motivational" ]; then
            echo "tech" > quote_type.txt
          else
            echo "motivational" > quote_type.txt
          fi
          git add quote_type.txt
          git commit -m "ğŸ” Switched quote type to $(cat quote_type.txt)"
          git push
