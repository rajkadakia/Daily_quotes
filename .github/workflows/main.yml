name: Rotate Single Quote

on:
  schedule:
    - cron: '0 0 */4 * *' # Every 4 days at midnight UTC
  workflow_dispatch: # Manual trigger

jobs:
  quote-bot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Git
        run: |
          git config --global user.name "rajkadakia"
          git config --global user.email "rk2163@srmist.edu.in"

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Fetch and insert single quote
        run: |
          TYPE=$(( RANDOM % 2 == 0 ? "motivational" : "tech" ))

          if [ "$TYPE" = "motivational" ]; then
            QUOTE=$(curl -s https://zenquotes.io/api/random | jq -r '.[0].q + " â€” " + .[0].a')
          else
            QUOTE=$(curl -s "https://api.quotable.io/random?tags=technology,famous-quotes" | jq -r '.content + " â€” " + .author')
          fi

          if [ -n "$QUOTE" ]; then
            echo "> _${QUOTE}_" > quote.txt
          else
            echo "> _No quote fetched this time._" > quote.txt
          fi

          # Insert quote between markers
          awk '/<!--QUOTE_START-->/ { print; while (getline < "quote.txt") print; skip=1; next }
               /<!--QUOTE_END-->/ { skip=0 }
               !skip' README.md > temp.md && mv temp.md README.md

      - name: Commit and Push
        run: |
          git add README.md
          git commit -m "ðŸ“Œ Added new quote" || echo "ðŸŸ¡ No changes to commit"
          git push
